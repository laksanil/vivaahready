generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ApprovalStatus: "pending" | "approved" | "rejected"

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String?
  name          String
  phone         String?
  emailVerified DateTime?
  phoneVerified DateTime?
  lastLogin     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  profile      Profile?
  subscription Subscription?
  sentMatches     Match[] @relation("SentMatches")
  receivedMatches Match[] @relation("ReceivedMatches")
  sentMessages    Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  reportsFiled    Report[] @relation("ReportsFiled")
  reportsReceived Report[] @relation("ReportsReceived")
}

model Profile {
  id        String   @id @default(cuid())
  odNumber  String?  @unique // Unique reference number
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Basic Info (from Google Form)
  gender            String   // male, female
  dateOfBirth       String?  // MM/DD/YYYY format
  age               String?  // Age in years (alternative to DOB)
  placeOfBirth      String?
  height            String?
  weight            String?  // Weight in kg or lbs
  dietaryPreference String?  // Vegetarian, Non Vegetarian, Eggetarian, Vegan
  motherTongue      String?  // Primary language
  healthInfo        String?  // Health conditions
  anyDisability     String?  // none, physical
  disabilityDetails String?  // Details if physical disability
  bloodGroup        String?  // A+, A-, B+, B-, AB+, AB-, O+, O-
  languagesKnown    String?
  maritalStatus     String?  // Single, Never Married, Divorced

  // Contact & Social
  linkedinProfile   String?
  facebookInstagram String?  // Legacy field - kept for backwards compatibility
  facebook          String?
  instagram         String?
  photoUrls         String?  // Comma-separated URLs from Google Drive
  profileImageUrl   String?  // Primary display photo (extracted from photoUrls or uploaded)
  drivePhotosLink   String?  // Link to Google Drive folder for additional photos
  photoVisibility   String?  @default("verified_only") // verified_only, matching_preferences, mutual_interest

  // Family Details
  fatherName        String?
  motherName        String?
  fatherOccupation  String?
  motherOccupation  String?
  numberOfBrothers  String?
  numberOfSisters   String?
  siblingDetails    String?
  familyType        String?  // nuclear, joint
  familyValues      String?  // traditional, moderate, liberal
  familyLocation    String?

  // Education & Career
  qualification     String?  // Bachelors, Masters, Doctor, Ph.D
  university        String?
  occupation        String?
  annualIncome      String?  // Range like "100-150K", ">100k"
  currentLocation   String?  // City, State
  zipCode           String?  // US zip code for distance calculations

  // Background
  religion          String?  // Hindu, Muslim, Christian, etc.
  caste             String?
  gotra             String?

  // Additional Career Details
  employerName      String?  // Company name
  workingAs         String?  // Job title/role

  // Living Situation
  livesWithFamily   String?  // yes, no
  createdBy         String?  // self, parent, sibling, relative, friend

  // Astro Details
  placeOfBirthCountry String?
  placeOfBirthState   String?
  placeOfBirthCity    String?
  timeOfBirth         String?
  manglik             String?  // yes, no, dont_know
  raasi               String?  // Moon sign
  nakshatra           String?  // Birth star
  doshas              String?  // Doshas if any

  // Lifestyle
  smoking           String?  // no, occasionally, yes
  drinking          String?  // no, social, yes
  hobbies           String?  // Comma-separated hobbies
  fitness           String?  // Comma-separated fitness activities
  interests         String?  // Comma-separated interests
  pets              String?  // have_love, no_but_love, no_but_open, prefer_not, allergic
  allergiesOrMedical String? // Allergies or medical conditions

  // About
  aboutMe           String?

  // Partner Preferences
  prefHeight        String?
  prefAgeDiff       String?  // "< 3 years", "between 3 to 5 years", etc.
  prefLocation      String?
  prefDiet          String?
  prefCaste         String?
  prefGotra         String?  // "Different Gothra", "Doesn't Matter"
  prefQualification String?
  prefIncome        String?
  prefLanguage      String?
  prefCountry       String?
  prefHobbies       String?  // doesnt_matter, same_as_mine, specific
  prefSpecificHobbies String? // Comma-separated specific hobbies if prefHobbies = specific
  prefFitness       String?  // doesnt_matter, same_as_mine, specific
  prefSpecificFitness String? // Comma-separated specific fitness if prefFitness = specific
  prefInterests     String?  // doesnt_matter, same_as_mine, specific
  prefSpecificInterests String? // Comma-separated specific interests if prefInterests = specific
  idealPartnerDesc  String?  // Free text description

  // Metadata
  citizenship       String?
  residencyStatus   String?
  grewUpIn          String?
  country           String?
  promoCode         String?
  referralSource    String?
  isImported        Boolean  @default(false)

  // Status
  approvalStatus    String @default("pending")
  approvalDate      DateTime?
  rejectionReason   String?
  isVerified        Boolean  @default(false)
  isActive          Boolean  @default(true)
  isSuspended       Boolean  @default(false)
  suspendedAt       DateTime?
  suspendedReason   String?
  profileScore      Int      @default(0)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Match {
  id          String   @id @default(cuid())
  senderId    String
  receiverId  String
  sender      User     @relation("SentMatches", fields: [senderId], references: [id], onDelete: Cascade)
  receiver    User     @relation("ReceivedMatches", fields: [receiverId], references: [id], onDelete: Cascade)

  status      String   @default("pending") // pending, accepted, rejected
  message     String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([senderId, receiverId])
}

model Subscription {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  plan            String   @default("free") // free, premium
  status          String   @default("active")

  // Profile payment tracking ($10 one-time fee)
  profilePaid     Boolean  @default(false)
  profilePaymentId String?  // Stripe payment intent ID

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Message {
  id          String   @id @default(cuid())
  senderId    String
  receiverId  String
  sender      User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver    User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  content     String
  read        Boolean  @default(false)
  readAt      DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([senderId])
  @@index([receiverId])
  @@index([senderId, receiverId])
}

model Report {
  id              String   @id @default(cuid())
  reporterId      String   // User who filed the report
  reportedUserId  String   // User being reported
  reporter        User     @relation("ReportsFiled", fields: [reporterId], references: [id], onDelete: Cascade)
  reportedUser    User     @relation("ReportsReceived", fields: [reportedUserId], references: [id], onDelete: Cascade)

  reason          String   // Text description of the problem
  status          String   @default("pending") // pending, reviewed, resolved, dismissed
  adminNotes      String?  // Notes from admin after review
  actionTaken     String?  // What action was taken (e.g., "suspended", "warned", "dismissed")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  reviewedAt      DateTime?

  @@index([reporterId])
  @@index([reportedUserId])
  @@index([status])
}

// Tracks profiles that a user has declined (not interested in)
// These profiles won't show in matching results but can be reconsidered
model DeclinedProfile {
  id              String   @id @default(cuid())
  userId          String   // User who declined
  declinedUserId  String   // User whose profile was declined

  createdAt       DateTime @default(now())

  @@unique([userId, declinedUserId])
  @@index([userId])
  @@index([declinedUserId])
}
